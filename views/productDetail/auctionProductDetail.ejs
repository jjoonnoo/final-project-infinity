<body>
    <!-- ì±„íŒ…
    <div id="container">
        <div id="chat_view"></div>
        <form id="chat_form" onsubmit="return false">
            <input type="text" id="msg">
            <input type="submit" id="send" value="ì „ì†¡">
        </form>
    </div> -->

    <div class="all_region">
        <div class="a_tag">
            <small class="category" id="category"></small>
            <a href="#" class="openBtn">ìƒí’ˆì‹ ê³  ğŸš¨</a>
            <hr />
            <small>ì¡°íšŒìˆ˜ | <%= views %></small>
            <br />
            <small id="seller"></small><br />
            <small id="rating"></small><br />
            <small id="bid_count">ê²½ë§¤ íšŸìˆ˜ | <%= count %></small><br />
            <small id="numClient"></small>
        </div>

        <div id="auction_product">
            <div class="product_region">
                <div id="carouselExample" class="carousel slide">
                    <div class="carousel-inner" id="img_container"></div>
                    <button
                        class="carousel-control-prev"
                        type="button"
                        data-bs-target="#carouselExample"
                        data-bs-slide="prev"
                    >
                        <span
                            class="carousel-control-prev-icon"
                            aria-hidden="true"
                        ></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button
                        class="carousel-control-next"
                        type="button"
                        data-bs-target="#carouselExample"
                        data-bs-slide="next"
                    >
                        <span
                            class="carousel-control-next-icon"
                            aria-hidden="true"
                        ></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
                <div class="product_area">
                    <div class="product_name_css">
                        <small>ìƒí’ˆëª…</small>
                        <hr />
                        <div id="product_name" class="product_name"></div>
                    </div>
                    <div class="product_info_css">
                        <small>ìƒí’ˆë‚´ìš©</small>
                        <hr />
                        <div id="product_content"></div>
                    </div>
                    <small id="product_buy_now_price" style="display: none">
                    </small>
                    <hr />
                    <small id="product_start_convert"></small>
                    <hr />
                    <small id="product_update_convert"
                        >ì…ì°°ê°€ <%= price %> ì›</small
                    >
                    <hr />
                    <small>ë§ˆê°ì‹œê°„</small>
                    <p id="product_end"></p>
                    <hr />
                </div>
            </div>
            <div
                class="chatbox"
                id="chatbox"
                title="í˜„ì¬ ê²½ë§¤ìƒí’ˆì— ëŒ€í•œ ì±„íŒ…ì°½ì…ë‹ˆë‹¤! ë¡œê·¸ì¸ í›„ ê²½ë§¤ ì°¸ì—¬ìë¼ë¦¬ ëŒ€í™”í•´ë³´ì„¸ìš”!"
            >
                <a style="margin: 15px">â­_chating</a>
            </div>
        </div>
        <div class="chatme" id="chatme"></div>
        <div class="button_region">
            <hr />

            <div id="countdown"></div>
            <div id="purchase_btn" style="display: none">
                <a href="#"
                    ><button class="btn1" id="btn1" onclick="purchaseNow()">
                        ì¦‰ì‹œ êµ¬ë§¤
                    </button></a
                >
            </div>

            <button class="openBtnBid" id="qwe" onclick="openBtnBid()">
                ì…ì°°
            </button>
            <div class="modalBid hiddenBid">
                <div class="bgBid"></div>
                <div class="modalBoxBid">
                    <p>
                        â€» ì…ì°° í›„ ì·¨ì†Œ ì‹œ ìˆ˜ìˆ˜ë£Œê°€ ë¶€ê³¼ë˜ë¯€ë¡œ ì‹ ì¤‘íˆ ì…ì°°í•˜ì„¸ìš”.
                    </p>
                    <p>ì…ì°° ê°€ê²©: <input type="text" id="bid_price" />ì›</p>
                    <button
                        class="modal_button"
                        type="button"
                        onclick="bidBtn()"
                    >
                        ì…ì°°í•˜ê¸°
                    </button>
                    <button class="closeBtnBid">ì·¨ì†Œ</button>
                    <p>â€» ì…ì°° ìµœì†Œ ê¸ˆì•¡ ë‹¨ìœ„</p>
                    <p>â—‹ ì…ì°°ê°€ 100ë§Œì›ì´ìƒ â–¶ 10ë§Œì›</p>
                    <p>â—‹ ì…ì°°ê°€ 50ë§Œì›ì´ìƒ ~ 100ë§Œì›ë¯¸ë§Œ â–¶ 5ë§Œì›</p>
                    <p>â—‹ ì…ì°°ê°€ 10ë§Œì›ì´ìƒ ~ 50ë§Œì›ë¯¸ë§Œ â–¶ 1ë§Œì›</p>
                    <p>â—‹ ì…ì°°ê°€ 10ë§Œì›ë¯¸ë§Œ â–¶ 5ì²œì›</p>
                </div>
            </div>

            <div class="modal hidden">
                <div class="bg"></div>
                <div class="modalBox">
                    ì‹ ê³  ì œëª©:
                    <select name="sltSample" size="1" id="report_title">
                        <option value="ë¶ˆì¹œì ˆí•œ ëŒ€ì‘" selected>
                            ë¶ˆì¹œì ˆí•œ ëŒ€ì‘
                        </option>
                        <option value="ë¶ˆëŸ‰ ìƒí’ˆ íŒë§¤">ë¶ˆëŸ‰ ìƒí’ˆ íŒë§¤</option>
                        <option value="ê·œì •ìœ„ë°˜ ìƒí’ˆ">ê·œì •ìœ„ë°˜ ìƒí’ˆ</option>
                        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                    </select>
                    <p>ì‹ ê³  ë‚´ìš©: <input type="text" id="report_content" /></p>
                    <button
                        class="modal_button"
                        type="button"
                        onclick="reportBtn()"
                    >
                        ì‹ ê³ í•˜ê¸°
                    </button>
                    <button class="closeBtn">ì·¨ì†Œ</button>
                </div>
            </div>
        </div>
    </div>
    <link rel="stylesheet" href="../css/auctionProductDetail.css" />
    <script type="text/javascript" src="../js/auctionProductDetail.js"></script>
</body>
<script>
    // const socket = io();

    // ê²½ë§¤ IDë¥¼ ì „ë‹¬í•˜ì—¬ í•´ë‹¹ ê²½ë§¤ì˜ ì±„íŒ…ë°©ì„ ìƒì„±í•œë‹¤
    socket.emit('createChatRoom', {
        auctionId: location.pathname.split('/')[2],
    });
    socket.on('roomCount', ({ count }) => {
        $('#numClient').text('ì°¸ì—¬ì¸ì› | ' + count + 'ëª…');
    });
    function sendmessage() {
        socket.emit('sendMessage', {
            auctionId: location.pathname.split('/')[2],
            message: $('#chat_content').val(),
            user_email: $('#user_email').val(),
        });
        document.getElementById('chat_content').value = '';
    }
    socket.on('chatMessage', ({ message, user_email }) => {
        appendchat(message, user_email);
    });
    socket.on('bid', ({ count, update_price }) => {
        $('#bid_count').text('ê²½ë§¤ íšŸìˆ˜ | ' + count);
        $('#product_update_price').attr(update_price);
        $('#product_update_convert').text(
            'ì…ì°°ê°€' + update_price.toLocaleString() + 'ì›'
        );
    });

    function appendchat(message, user_email) {
        if ($('#user_email').val() === user_email) {
            let temp = `        <form>
        <div>
            <input style="text-align:right" value="${user_email}" readonly>
            <br>
            <input style="text-align:right" value="${message}" readonly>
        </div>
    </form>`;
            $('#chatbox').append(temp);
        } else {
            let temp = `        <form>
        <div>
            <input style="text-align:left" value="${user_email}" readonly>
            <br>
            <input style="text-align:left" value="${message}" readonly>
        </div>
    </form>`;
            $('#chatbox').append(temp);
        }

        document.getElementById('chatbox').scrollTop =
            document.getElementById('chatbox').scrollHeight;
    }
    function purchase() {
        if (!confirm('êµ¬ë§¤ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            alert('êµ¬ë§¤ë¥¼ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.');
            location.href = `/auction/${auction_product_id}`;
            return;
        } else {
            $.ajax({
                type: 'GET',
                url: '/api/users/getmyinfo',
                data: {},
                success: function (response) {
                    const auction_product_id = location.pathname.split('/')[2];
                    socket.emit('bid', { auction_product_id, bid_price });
                    alert('êµ¬ë§¤ì™„ë£Œ');
                    window.location.reload();
                },
                error: function (error) {
                    alert(error.responseJSON.message);
                    window.location.href = '/';
                },
            });
        }
    }
</script>
